w<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Printr -- HP Backed Social Network</title>

		<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <meta name="description" content="">
	    <meta name="author" content="">

		<link rel="stylesheet" href="../css/stylesheet.css">

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

		<!-- Optional theme -->
		<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"> -->

	</head>

	<body>
		<div class="container">
			<div class="header">
				<ul class="nav nav-pills pull-right">
					<li class="active"><a href="#">Printers</a></li>
					<li class="dropdown" id="accountmenu"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">Printers<b class="caret"></b></a>
						<ul id="printer-list" class="dropdown-menu">
							<li class="divider"></li>
							<li><a id="add-new-printer-button" href="#">New Printer</a></li>
						</ul>
					</li>
					<li><a href="https://github.com/mcdonamp/printr">Source</a></li>
				</ul>
				<h3 class="text-muted">Printr</h3>
			</div>

			<div class="jumbotron">
				<h2 id="printer-name-heading">Printer Name</h2>
				<div id="message-background"></div>
			</div>

		 	<div class="input-group">
		      	<input id="message-input-field" type="text" class="form-control">
		     		<span class="input-group-btn">
		        		<button id="button-post" class="btn btn-default" type="button">Printr!</button>
		      	</span>
			</div>

	    	<div class="footer">
	    		<p>&copy; Mike McDonald 2014</p>
	    	</div>
    	</div>

    	<!-- Firebase -->
		<script src="https://cdn.firebase.com/js/client/1.0.23/firebase.js"></script>

		<!-- Firebase Simple Login -->
		<script src="https://cdn.firebase.com/js/simple-login/1.6.4/firebase-simple-login.js"></script>

    	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

		<script type="text/javascript">
			$(function() {
				// Global vars
				var currentPrinter = "";

    			// Set up Firebase
    			var ref = new Firebase('https://printrapp.firebaseio.com');
    			var printerRef = ref.child('Printers');
    			var messagesRef = ref.child('Messages');

    			printerRef.on('child_added', function(snapshot){
    				currentPrinter = snapshot.name();
    				$('#printer-list').prepend('<li id="printer-' + snapshot.name() + '"><a href="#">' + snapshot.name() + '</a></li>');
    				$('#printer-'+snapshot.name()).on('click', function(){
    					currentPrinter = snapshot.name();
    					$('#printer-name-heading').text(currentPrinter);
    					$("#message-background").children().hide();
    					$('#message-'+currentPrinter).show();
    					console.log(currentPrinter);
    				});
    				messagesRef.child(currentPrinter).limit(1).on('child_added', function(snapshot){
    						console.log(snapshot.name() + " " + snapshot.val());
    						$('#message-background').append('<p id="message-' + currentPrinter + '">' + snapshot.val()['message'] + '</p>');
    				});
    			});

    			printerRef.on('child_removed', function(snapshot){
    				$('#printer-'+snapshot.name()).remove();
    			});

    			// Set up listeners on buttons
    			$("#button-post").on('click', function() {
    				var text = $('#message-input-field').val();
    				messagesRef.child(currentPrinter).push({"username":"Mike","message":text});
    				// console.log(text);
    			});

    			$("#add-new-printer-button").on('click', function() {
    				console.log("Pop up a new modal for the printer");
    			});
			});
		</script>
	</body>
</html>